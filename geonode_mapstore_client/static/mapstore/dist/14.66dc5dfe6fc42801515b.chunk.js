(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"./MapStore2/web/client/components/TOC/fragments/settings/ThematicLayer.jsx":function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f(e);if(t){var a=f(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return u(this,r)}}function u(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?m(e):t}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var h=r("./node_modules/prop-types/index.js"),y=r("./node_modules/react/index.js"),g=r("./node_modules/react-bootstrap/es/index.js"),C=g.ControlLabel,b=g.FormGroup,E=g.Row,v=g.Col,S=g.Grid,x=g.Alert,j=g.Checkbox,k=r("./node_modules/lodash/lodash.js"),w=k.isObject,I=k.isEqual,O=r("./node_modules/react-widgets/lib/index.js").Combobox,P=r("./node_modules/object-assign/index.js"),_=r("./MapStore2/web/client/components/I18N/Message.jsx"),T=r("./MapStore2/web/client/components/misc/switch/SwitchPanel.jsx"),L=r("./MapStore2/web/client/components/styleeditor/ColorRamp.jsx").default,z=r("./node_modules/react-codemirror2/index.js").Controlled,R=r("./node_modules/react-widgets/lib/index.js").NumberPicker;r("./node_modules/codemirror/lib/codemirror.css"),r("./node_modules/codemirror/mode/javascript/javascript.js");var V=r("./MapStore2/web/client/utils/LocaleUtils.js").getMessageById,M=r("./node_modules/tinycolor2/tinycolor.js"),N=r("./MapStore2/web/client/components/style/ColorPicker.jsx").default,D=r("./MapStore2/web/client/components/misc/LoadingView.jsx"),F=r("./MapStore2/web/client/components/style/ThemaClassesEditor.jsx"),A={current:void 0,unconfigured:void 0,applied:void 0},W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(u,e);var t,r,n,a=p(u);function u(){var e;l(this,u);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return d(m(e=a.call.apply(a,[this].concat(r))),"getCurrentThema",(function(t){var r=e.props.getThematicParameters(t.params||[]).reduce((function(e,t){return P(e,d({},t.field,t.defaultValue))}),{});return P({},e.props.initialParams,{attribute:t.attribute||""},r,t.applied)})),d(m(e),"getClassification",(function(){return e.props.layer.thematic.current.classification||e.props.classification||[]})),d(m(e),"getValue",(function(e){return!w(e)&&e||e.value||e.name})),d(m(e),"getColors",(function(){var t=e.props.getColors(e.props.colors,e.props.layer,e.props.colorSamples);return t?t.map((function(e){var t=e.name,r=i(e,["name"]);return o({label:"global.colors.".concat(t),name:t},r)})):[]})),d(m(e),"renderError",(function(t,r){return y.createElement(x,{bsStyle:"danger"},y.createElement(_,{msgId:"toc.thematic."+r,msgParams:{message:e.localizedItem(t.message,"")}}))})),d(m(e),"renderInputError",(function(t){var r=e.props.invalidInputs[t];return r?y.createElement(x,{bsStyle:"danger"},y.createElement(_,{msgId:r.message,msgParams:r.params||{}})):null})),d(m(e),"renderThemaPanel",(function(t){return y.createElement(E,null,y.createElement(v,{xs:12},y.createElement(T,{expanded:!0,locked:!0,title:e.localizedItem("toc.thematic.data_panel",""),buttons:[{glyph:"cog",tooltip:e.localizedItem("toc.thematic.go_to_cfg",""),visible:e.props.canEditThematic,onClick:e.toggleCfg}]},y.createElement(S,{fluid:!0},y.createElement(E,null,e.props.layer.thematic.params&&e.props.layer.thematic.params.length?e.renderParams(t):null,y.createElement(v,{xs:12},y.createElement(b,null,y.createElement(v,{xs:6},y.createElement(C,null,y.createElement(_,{msgId:"toc.thematic.classification_field"}))),y.createElement(v,{xs:6},y.createElement(O,{disabled:e.hasCustomClassification(),busy:e.props.fieldsLoading.status,data:e.props.fields,textField:"name",valueField:"name",value:t.field,onChange:function(t){return e.updateStyle("field",e.getValue(t))}}))))),y.createElement(E,null,y.createElement(v,{xs:12},e.props.fieldsLoading.error?e.renderError(e.props.fieldsLoading.error,"fields_error"):null))))),",",y.createElement(v,{xs:12},y.createElement(T,{expanded:!0,locked:!0,title:y.createElement(_,{msgId:"toc.thematic.classify"}),buttons:[{glyph:"trash",tooltip:e.localizedItem("toc.thematic.remove",""),onClick:e.removeStyle,visible:e.props.enableRemoveStyle&&e.props.hasThematicStyle(e.props.layer)},{glyph:"undo",tooltip:e.localizedItem("toc.thematic.restore",""),onClick:e.restoreStyle,visible:e.hasCustomClassification()},{glyph:"ok",disabled:!e.props.applyEnabled||Object.keys(e.props.invalidInputs).length>0,tooltip:e.localizedItem("toc.thematic.apply",""),onClick:function(){return e.applyStyle(e.props.layer)}}]},y.createElement(S,{fluid:!0},y.createElement(E,null,y.createElement(v,{xs:12},y.createElement(b,null,y.createElement(v,{xs:6},y.createElement(C,null,y.createElement(_,{msgId:"toc.thematic.classification_method"}))),y.createElement(v,{xs:6},y.createElement(O,{disabled:e.hasCustomClassification(),data:e.props.methods,textField:e.localizedItem,defaultValue:t.method,onSelect:function(t){return e.updateStyle("method",e.getValue(t))}})))),y.createElement(v,{xs:12},y.createElement(b,null,y.createElement(v,{xs:6},y.createElement(C,null,y.createElement(_,{msgId:"toc.thematic.classification_intervals"}))),y.createElement(v,{xs:6},y.createElement(R,{disabled:e.hasCustomClassification(),value:t.intervals,onChange:function(t){e.updateStyle("intervals",e.constrainIntervals(e.getValue(t)))}}))),e.renderInputError("intervals")),y.createElement(v,{xs:12},y.createElement(b,null,y.createElement(v,{xs:6},y.createElement(C,null,y.createElement(_,{msgId:"toc.thematic.classification_colors"}))),y.createElement(v,{xs:6},y.createElement(L,{items:e.getColors(),rampFunction:e.createRamp,value:{name:t.ramp},disabled:e.hasCustomClassification(),samples:5,onChange:function(t){e.updateStyle("ramp",e.getValue(t))}})))),"LineString"!==e.props.geometryType?y.createElement(v,{xs:12},y.createElement(b,null,y.createElement(v,{xs:6},y.createElement(C,null,y.createElement(_,{msgId:"toc.thematic.classification_stroke"}))),y.createElement(v,{xs:1},y.createElement(j,{checked:t.strokeOn,onChange:function(t){return e.updateStyle("strokeOn",t.target.checked)}})),y.createElement(v,{xs:2},y.createElement(N,{key:"strokeColor",pickerProps:{disableAlpha:!0},disabled:!t.strokeOn,text:t.strokeColor,value:o(o({},M(t.strokeColor).toRgb()),{},{a:100}),onChangeColor:e.updateStrokeColor})),y.createElement(v,{xs:3},y.createElement(R,{key:"strokeWeight",disabled:!t.strokeOn,format:"- ###.###",value:t.strokeWeight,onChange:e.updateStrokeWeight})))):null),y.createElement(E,null,y.createElement(v,{xs:12},e.props.classificationLoading.status?y.createElement(D,{width:e.props.loaderSize,height:e.props.loaderSize}):null,e.renderInputError("classification"),y.createElement(F,{className:e.props.classificationLoading.status?"loading":"",classification:e.getClassification(),onUpdateClasses:e.updateClassification}),e.props.classificationLoading.error?e.renderError(e.props.classificationLoading.error,"classification_error"):null))))))})),d(m(e),"renderConfigurationEditor",(function(){var t=e.isConfigurationValid();return y.createElement(E,null,y.createElement(v,{xs:12},y.createElement(T,{expanded:!0,locked:!0,title:y.createElement(_,{msgId:"toc.thematic.configuration"}),buttons:[{glyph:"arrow-right",tooltip:e.localizedItem("toc.thematic.go_to_thema",""),onClick:function(){return e.applyCfg(e.props.adminCfg.current)},visible:t},{glyph:"exclamation-mark",tooltip:e.localizedItem("toc.thematic.cfgError",""),glyphClassName:"text-danger",visible:!t}]},y.createElement(z,{ref:function(t){e.cfgEditor=t},style:{width:"500px"},key:"code-mirror",value:e.props.adminCfg.current,onBeforeChange:e.updateCfg,options:{theme:"midnight",mode:{name:"javascript"},lineNumbers:!0}}))))})),d(m(e),"renderParams",(function(t){return e.props.getThematicParameters(e.props.layer.thematic.params).map((function(r){return y.createElement(v,{xs:12},y.createElement(b,null,y.createElement(v,{xs:6},y.createElement(C,null,e.localizedItem(r.title,""))),y.createElement(v,{xs:6},y.createElement(O,{data:r.values,textField:function(t){return e.localizedItem(t.name,"")},valueField:"value",value:t[r.field],onSelect:function(t){return e.updateStyle(r.field,e.getValue(t))}}))))}))})),d(m(e),"constrainIntervals",(function(t){return isNaN(t)||t<2||t>e.props.maxClasses?e.props.onInvalidInput("intervals","toc.thematic.interval_limit",{min:2,max:e.props.maxClasses}):e.props.onValidInput("intervals"),t})),d(m(e),"checkInitialStyle",(function(t){var r=t.layer.thematic;!t.hasThematicStyle(t.layer)&&r&&!r.unconfigured&&r.current&&r.current.field&&t.classification&&t.classification.length&&e.applyStyle(t.layer)})),d(m(e),"hasConfiguration",(function(){return e.props.layer.thematic&&!e.props.layer.thematic.unconfigured})),d(m(e),"updateStrokeColor",(function(t){t&&e.updateStyle("strokeColor",M(t).toHexString())})),d(m(e),"updateStrokeWeight",(function(t){e.updateStyle("strokeWeight",t)})),d(m(e),"hasCustomClassification",(function(){return!!e.props.layer.thematic.current.classification})),d(m(e),"removeStyle",(function(){var t=e.props.layer,r=e.props.removeThematicStyle(t.params);e.props.onChange({params:r,thematic:P({},t.thematic,{applied:P({},t.thematic.current)})})})),d(m(e),"updateClassification",(function(t){e.props.onChange("thematic",P({},e.props.layer.thematic,{current:P({},e.props.layer.thematic.current,{classification:t})})),e.validClassification(t)?e.props.onValidInput("classification"):e.props.onInvalidInput("classification","toc.thematic.invalid_classes"),e.props.onDirtyStyle()})),d(m(e),"validClassification",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return!e.reduce((function(e,t){return e||t.max<t.min}),!1)})),d(m(e),"createRamp",(function(e){return e.colors})),d(m(e),"isConfigurationValid",(function(){try{return JSON.parse(e.props.adminCfg.current),!0}catch(e){return!1}})),d(m(e),"applyCfg",(function(t){try{var r=JSON.parse(t),n=P({},r,{current:e.getCurrentThema(r),unconfigured:!1});e.props.onChange("thematic",n),e.props.onSwitchLayer(P({},e.props.layer,{thematic:n})),e.props.onChangeConfiguration(e.props.layer,!1,t)}catch(r){e.props.onChangeConfiguration(e.props.layer,!0,t,r.message)}})),d(m(e),"updateCfg",(function(t,r,n){e.props.onChangeConfiguration(e.props.layer,!0,n)})),d(m(e),"toggleCfg",(function(){e.props.onChangeConfiguration(e.props.layer,!e.props.adminCfg.open,e.props.adminCfg.current)})),d(m(e),"localizedItem",(function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"toc.thematic.values.";return V(e.context.messages,r+t)})),d(m(e),"switchLayer",(function(t){if(t.thematic){var r=e.getCurrentThema(t.thematic);e.props.onChange("thematic",P({},t.thematic,{current:r}))}e.props.onSwitchLayer(t)})),d(m(e),"restoreStyle",(function(){var t=P({},e.props.layer,{thematic:P({},e.props.layer.thematic,{current:P({},e.props.layer.thematic.current,{classification:null})})});e.updateStyle("classification",null,!0),e.applyStyle(t)})),d(m(e),"applyStyle",(function(t){var r=P({},t.params,e.props.getStyleParameters(t,t.thematic.current));e.props.onChange({params:r,thematic:P({},t.thematic,{applied:P({},t.thematic.current)})}),e.props.onApplyStyle()})),d(m(e),"needsToUpdateClassification",(function(t){return!e.hasCustomClassification()&&-1===["strokeOn","strokeColor","strokeWeight"].indexOf(t)||"classification"===t})),d(m(e),"updateStyle",(function(t,r,n){var a=e.props.layer,o=P({},a.thematic.current,d({},t,r)),i=P({},a.thematic,{current:o});if(e.props.onChange("thematic",i),e.needsToUpdateClassification(t)){var l=P({},e.props.getMetadataParameters(a,o));e.props.onClassify(P({},a,{thematic:i}),l)}n||e.props.onDirtyStyle()})),e}return t=u,(r=[{key:"UNSAFE_componentWillMount",value:function(){this.props.layer&&(this.props.onChangeConfiguration(this.props.layer,!1,JSON.stringify(P({},this.props.layer.thematic,A),null,4)),this.hasConfiguration()?this.switchLayer(this.props.layer):this.applyCfg("{}"),this.checkInitialStyle(this.props))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(!e.layer||this.props.layer&&e.layer.id===this.props.layer.id||this.switchLayer(e.layer),e.fields&&e.fields.length&&!I(e.fields,this.props.fields)){var t=e.layer.thematic.applied&&e.layer.thematic.applied.field||e.fields[0].name;this.updateStyle("field",t,!0)}this.checkInitialStyle(e)}},{key:"render",value:function(){var e=this.props.layer&&this.props.layer.thematic&&this.props.layer.thematic.current;return y.createElement(S,{fluid:!0,className:"thematic_layer"},this.props.canEditThematic&&this.props.adminCfg.open?this.renderConfigurationEditor():null,this.hasConfiguration()&&!this.props.adminCfg.open&&e?this.renderThemaPanel(e):null)}}])&&s(t.prototype,r),n&&s(t,n),u}(y.Component);d(W,"propTypes",{layer:h.object,onChange:h.func,onChangeConfiguration:h.func,onSwitchLayer:h.func,onApplyStyle:h.func,onClassify:h.func,onDirtyStyle:h.func,onInvalidInput:h.func,onValidInput:h.func,getStyleParameters:h.func,getThematicParameters:h.func,getMetadataParameters:h.func,getColors:h.func,hasThematicStyle:h.func,removeThematicStyle:h.func,colors:h.array,fields:h.array,fieldsLoading:h.object,classification:h.array,classificationLoading:h.object,initialParams:h.object,methods:h.array,canEditThematic:h.bool,colorSamples:h.number,maxClasses:h.number,loaderSize:h.number,adminCfg:h.object,enableRemoveStyle:h.bool,applyEnabled:h.bool,invalidInputs:h.object,geometryType:h.string}),d(W,"contextTypes",{messages:h.object}),d(W,"defaultProps",{onChange:function(){},onChangeConfiguration:function(){},onInvalidInput:function(){},onValidInput:function(){},getStyleParameters:function(){},getThematicParameters:function(e){return e},getMetadataParameters:function(){},hasThematicStyle:function(){},removeThematicStyle:function(){},getColors:function(e){return e},onSwitchLayer:function(){},onClassify:function(){},onApplyStyle:function(){},onDirtyStyle:function(){},canEditThematic:!1,fieldsLoading:{status:!1,error:null},classificationLoading:{status:!1,error:null},initialParams:{},colorSamples:5,maxClasses:15,loaderSize:100,adminCfg:{open:!1,current:null,error:null},enableRemoveStyle:!1,applyEnabled:!1,invalidInputs:{},geometryType:"Polygon"}),e.exports=W}}]);